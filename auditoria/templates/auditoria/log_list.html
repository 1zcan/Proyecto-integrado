{% extends "base.html" %}

{% block title %}Auditoría del sistema{% endblock %}

{% block content %}
<h4 class="mb-3">Bitácora de acciones</h4>
<p class="text-muted small">
    Registro de modificaciones sobre datos sensibles de pacientes, partos y recién nacidos.
</p>

<div class="card shadow-sm card-audit">
    <div class="card-body p-0">
        <table class="table table-sm mb-0 align-middle table-hover">
            <thead class="table-light">
                <tr>
                    <th>Fecha</th>
                    <th>Usuario</th>
                    <th>Acción</th>
                    <th>Modelo</th>
                    <th>ID objeto</th>
                    <th>IP</th>
            
                </tr>
            </thead>
            <tbody>
            {% for log in logs %}
                <tr>
                    <td class="text-nowrap">{{ log.timestamp|date:"d/m/Y H:i" }}</td>
                    <td>{{ log.usuario|default:"-" }}</td>
                    
                    <td>
                        {% if log.accion == 'create' %}
                            <span class="badge bg-success-subtle text-success-emphasis">
                        {% elif log.accion == 'update' %}
                            <span class="badge bg-warning-subtle text-warning-emphasis">
                        {% elif log.accion == 'delete' %}
                            <span class="badge bg-danger-subtle text-danger-emphasis">
                        {% else %}
                            <span class="badge bg-secondary-subtle text-secondary-emphasis">
                        {% endif %}
                            {{ log.get_accion_display }}
                        </span>
                    </td>
                    
                    <td>{{ log.modelo }}</td>
                    <td>{{ log.objeto_id }}</td>
                    <td class="text-nowrap">{{ log.ip_address|default:"-" }}</td>
                 
                </tr>
            {% empty %}
                <tr>
                    <td colspan="7" class="text-center text-muted py-3">
                        Aún no hay registros de auditoría.
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if is_paginated %}
<nav class="mt-3">
  <ul class="pagination pagination-sm justify-content-end">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a>
      </li>
    {% endif %}
    <li class="page-item disabled">
      <span class="page-link">
        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span>
    </li>
    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Siguiente</a>
      </li>
    {% endif %}
  </ul>
</nav>
{% endif %}

<style>
    
    h4 {
        font-weight: 600;
        color: #212529;
    }

  
    .card-audit {
        border: none;
        border-radius: 8px;
        

        overflow: hidden; 
    }


    .card-audit .table thead {
       
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }
    
    .card-audit .table th {
        font-weight: 500;
        color: #495057;
        font-size: 0.8rem; 
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding-top: 0.75rem;
        padding-bottom: 0.75rem;
    }

    
    .card-audit .table td {
        font-size: 0.9rem;
        color: #343a40;
        vertical-align: middle; 
    }
    
  
    .badge {
        font-weight: 500;
    }

    
    .pagination .page-link {
        border-radius: 4px;
        margin: 0 2px;
        color: #007bff; 
    }
    .pagination .page-item.disabled .page-link {
        color: #6c757d;
    }

</style>
{% endblock %}